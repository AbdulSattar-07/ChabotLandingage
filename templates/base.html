{% load static %}
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ settings.seo_title|default:"RoyalERP Chatbot" }}</title>
    <meta name="description" content="{{ settings.seo_description|default:'AI-Powered ERP Assistant' }}">

    <!-- Open Graph -->
    <meta property="og:title" content="{{ settings.seo_title }}">
    <meta property="og:description" content="{{ settings.seo_description }}">
    {% if settings.og_image %}
    <meta property="og:image" content="{{ settings.og_image.url }}">{% endif %}

    <!-- Favicon -->
    {% if settings.favicon %}
    <link rel="icon" href="{{ settings.favicon.url }}">{% endif %}

    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '{{ settings.primary_color|default:"#1e3a5f" }}',
                        secondary: '{{ settings.secondary_color|default:"#6366f1" }}',
                        accent: '{{ settings.accent_color|default:"#ec4899" }}',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    {% block extra_css %}{% endblock %}

    <style>
        {
            % block inline_css %
        }

            {
            % endblock %
        }
    </style>
</head>

<body class="font-sans antialiased text-gray-800 bg-white">
    {% block navbar %}{% endblock %}
    <div class="page-wrapper">
    {% block content %}{% endblock %}
    </div>
    {% block extra_js %}{% endblock %}
    
    <!-- Enterprise-Grade Navbar Script -->
    <script>
        (function() {
            'use strict';
            
            const navbar = document.getElementById('navbar');
            const scrollIndicator = document.getElementById('scroll-indicator');
            const socialIcons = document.getElementById('social-icons');
            const heroSection = document.getElementById('hero');
            
            // Constants
            const SCROLL_THRESHOLD = 50;
            const NAVBAR_HEIGHT = 70;
            
            // Get hero height for hiding scroll indicator/social icons
            function getHeroHeight() {
                return heroSection ? heroSection.offsetHeight : window.innerHeight;
            }
            
            // Force navbar to be visible with inline styles
            function forceNavbarVisible() {
                if (!navbar) return;
                
                navbar.style.position = 'fixed';
                navbar.style.top = '0';
                navbar.style.left = '0';
                navbar.style.right = '0';
                navbar.style.width = '100%';
                navbar.style.zIndex = '2147483647';
                navbar.style.display = 'block';
                navbar.style.visibility = 'visible';
                navbar.style.opacity = '1';
                navbar.style.pointerEvents = 'auto';
                navbar.style.transform = 'none';
            }
            
            // Update navbar background based on scroll
            function updateNavbarBackground(scrollY) {
                if (!navbar) return;
                
                if (scrollY > SCROLL_THRESHOLD) {
                    navbar.classList.add('scrolled', 'navbar-scrolled');
                    navbar.style.background = 'linear-gradient(135deg, #1e3a5f 0%, #6366f1 100%)';
                    navbar.style.boxShadow = '0 4px 30px rgba(0, 0, 0, 0.3)';
                } else {
                    navbar.classList.remove('scrolled', 'navbar-scrolled');
                    navbar.style.background = 'transparent';
                    navbar.style.boxShadow = 'none';
                }
            }
            
            // Update scroll indicator and social icons visibility
            function updateSideElements(scrollY) {
                const heroHeight = getHeroHeight();
                const hideThreshold = heroHeight - 100;
                
                if (scrollIndicator) {
                    if (scrollY > hideThreshold) {
                        scrollIndicator.style.opacity = '0';
                        scrollIndicator.style.pointerEvents = 'none';
                    } else {
                        scrollIndicator.style.opacity = '1';
                        scrollIndicator.style.pointerEvents = 'auto';
                    }
                }
                
                if (socialIcons) {
                    if (scrollY > hideThreshold) {
                        socialIcons.style.opacity = '0';
                        socialIcons.style.pointerEvents = 'none';
                    } else {
                        socialIcons.style.opacity = '1';
                        socialIcons.style.pointerEvents = 'auto';
                    }
                }
            }
            
            // Main scroll handler
            function handleScroll() {
                const scrollY = window.scrollY || window.pageYOffset;
                
                // ALWAYS keep navbar visible
                forceNavbarVisible();
                
                // Update background
                updateNavbarBackground(scrollY);
                
                // Update side elements
                updateSideElements(scrollY);
            }
            
            // Initialize
            function init() {
                // Force navbar visible immediately
                forceNavbarVisible();
                
                // Initial scroll check
                handleScroll();
                
                // Initialize side elements
                if (scrollIndicator) {
                    scrollIndicator.style.transition = 'opacity 0.5s ease';
                }
                if (socialIcons) {
                    socialIcons.style.transition = 'opacity 0.5s ease';
                }
                
                // Scroll listener with passive for performance
                window.addEventListener('scroll', handleScroll, { passive: true });
                
                // Resize listener to recalculate hero height
                window.addEventListener('resize', handleScroll, { passive: true });
                
                // Ensure navbar stays visible even after dynamic content loads
                window.addEventListener('load', forceNavbarVisible);
                
                // MutationObserver to catch any style changes
                if (navbar) {
                    const observer = new MutationObserver(function(mutations) {
                        mutations.forEach(function(mutation) {
                            if (mutation.attributeName === 'style') {
                                // Re-apply critical styles if they were changed
                                const currentZ = navbar.style.zIndex;
                                if (currentZ !== '2147483647') {
                                    forceNavbarVisible();
                                }
                            }
                        });
                    });
                    
                    observer.observe(navbar, { attributes: true, attributeFilter: ['style'] });
                }
            }
            
            // Run initialization
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();
    </script>
</body>

</html>